[{"title":"Django+xadmin打造在线教育平台-用户登录注册功能的实现","date":"2018-09-01T05:11:33.000Z","path":"2018/09/01/Django-xadmin打造在线教育平台-用户登录注册功能的实现/","text":"&emsp;&emsp;对于web网站，小到一个博客系统，大到购物平台，用户管理是不可或缺的。包括了用户的注册、登录、修改重置密码、修改个人信息等，今天就来聊一聊用户管理那些事儿~ 用户管理&emsp;&emsp;其实django自带了一个用户认证模块，django.contrib.auth，auth模块是对登录认证方法的一种封装，之前我们获取用户输入的用户名及密码后需要自己从user表里查询有没有用户名和密码符合的对象，而有了auth模块之后就可以很轻松的去验证用户的登录信息是否存在于数据库中。 auth里的方法 authenticate():提供了用户认证，即验证用户名以及密码是否正确，如果认证信息有效，会返回一个 User 对象。authenticate()会在 User 对象上设置一个属性标识表明认证后端认证了该用户，且该信息在后面的登录过程中是需要的。当我们试图登陆一个从数据库中直接取出来不经过authenticate()的User对象会报错的！！ user = authenticate(username=’someone’,password=’somepassword’) login(HttpRequest, user):该函数接受一个HttpRequest对象，以及一个认证了的User对象，此函数使用django的session框架给某个已认证的用户附加上session id等信息 12345username = request.POST[&apos;username&apos;]password = request.POST[&apos;password&apos;]user = authenticate(username=username, password=password)if user is not None: login(request, user) logout(request):该函数接受一个HttpRequest对象，无返回值。当调用该函数时，当前请求的session信息会全部清除。该用户即使没有登录，使用该函数也不会报错。 12def logout_view(request): logout(request) user对象的 is_authenticated():要求：1 用户登陆后才能访问某些页面，2 如果用户没有登录就访问该页面的话直接跳到登录页面3 用户在跳转的登陆界面中完成登陆后，自动访问跳转到之前访问的地址 123def my_view(request): if not request.user.is_authenticated(): return redirect(&apos;%s?next=%s&apos; % (settings.LOGIN_URL, request.path)) 对于用户是否登录的认证还有其他方法,比如修饰器和类的继承方式: 修饰器方式123from django.contrib.auth.decorators import login_required@login_requireddef my_view(request): 若用户没有登录，则会跳转到django默认的登录URL ‘/accounts/login/ ‘ (这个值可以在settings文件中通过LOGIN_URL进行修改)。并传递 当前访问url的绝对路径 ( 登陆成功后，会重定向到该路径 )。 LoginRequiredMixin123456789101112from django.contrib.auth.decorators import login_requiredfrom django.utils.decorators import method_decoratorfrom django.shortcuts import reverseLOGIN_URL = &apos;/users/login/&apos;class LoginRequiredMixin(object): @method_decorator(login_required(login_url=LOGIN_URL)) def dispatch(self,request,*args,**kwargs): return super(LoginRequiredMixin, self).dispatch(request,*args,**kwargs) class ImageUploadView(LoginRequiredMixin,View): user对象 username 用户名password（必填项）password用哈希算法保存到数据库is_staff ： 用户是否拥有网站的管理权限.is_active ： 是否允许用户登录, 设置为False，可以不用删除用户来禁止用户登录check_password(passwd) 如果给定的字符串通过了密码检查，返回 Trueset_password() 修改密码 自定义user表&emsp;&emsp;以上的所有操作，都是针对django自动创建的auth_user表，如果要用auth模块，就必须要使用（或继承）这张表。继承表的好处是我们可以增加一些自己需要的字段，并且同时可以使用auth模块提供的接口、方法,而我们项目中的UserProfile就是继承该表. #","tags":[{"name":"django项目","slug":"django项目","permalink":"http://yoursite.com/tags/django项目/"},{"name":"Mxonline","slug":"Mxonline","permalink":"http://yoursite.com/tags/Mxonline/"}]},{"title":"Django+xadmin打造在线教育平台-xadmin的使用","date":"2018-09-01T05:10:09.000Z","path":"2018/09/01/Django-xadmin打造在线教育平台-xadmin的使用/","text":"&emsp;&emsp;django自带了admin用于后台管理,但是在github上还有一个更好看、功能更强大的库来管理后台,叫xadmin,今天就来好好介绍一下xadmin的使用. xadmin的安装&emsp;&emsp;通过文档我们可以发现，我们有两种方法可以进行安装。 使用pip install 安装 pip install django-xadmin 下载源码安装 需要安装requirements.txt中的依赖包 &emsp;&emsp;我使用的是源码安装,到github搜索xadmin,然后下载源码,然后在项目的工程目录下新建一个extra_apps,把源码放在该目录下,注意extra_apps需要与apps一样在settings中设置。这里不在重复叙述了,然后手动安装requirements.txt中的依赖包.最后在INSTALLED_APPS中添加xadmin和crispy_forms.&emsp;&emsp;接下来配置url: from extra_apps import xadminurl(r’^xadmin/‘, xadmin.site.urls), &emsp;&emsp;然后执行migrations和migrate生成数据库表并创建superuser.就可以访问登录啦 注册app到xadmin后台 在app文件夹中新建adminx.py:123456789101112import xadminfrom .models import EmailVerifyRecord#xadmin中这里是继承object，不再是继承adminclass EmailVerifyRecordAdmin(object): # 显示的列 list_display = [&apos;code&apos;, &apos;email&apos;, &apos;send_type&apos;, &apos;send_time&apos;] # 搜索的字段，不要添加时间搜索 search_fields = [&apos;code&apos;, &apos;email&apos;, &apos;send_type&apos;] # 过滤 list_filter = [&apos;code&apos;, &apos;email&apos;, &apos;send_type&apos;, &apos;send_time&apos;]xadmin.site.register(EmailVerifyRecord,EmailVerifyRecordAdmin) xadmin的全局配置 全局配置,包括title和footer等 app名称汉化，菜单收叠。 使用Xadmin的主题功能。 全局配置12345678910from xadmin import viewsclass GlobalSettings(object): # 修改title site_title = &apos;Mxonline后台管理界面&apos; # 修改footer site_footer = &apos;在线教育平台&apos; # 收起菜单 menu_style = &apos;accordion&apos; #将title和footer信息进行注册xadmin.site.register(views.CommAdminView,GlobalSettings) 主题功能12345678from xadmin import views#创建xadmin的最基本管理器配置，并与view绑定class BaseSetting(object): # 开启主题功能 enable_themes = True use_bootswatch = True#将基本配置管理与view绑定xadmin.site.register(views.BaseAdminView,BaseSetting) 修改app的名字&emsp;&emsp;在后台左侧的app显示还是英文,如果要设置为中文需要在apps.py中添加verbose_name,然后在init.py中添加default_app_config.12345678apps.pyfrom django.apps import AppConfigclass UsersConfig(AppConfig): name = &apos;users&apos; verbose_name = &apos;用户&apos; __init__.pydefault_app_config = &apos;users.apps.UsersConfig&apos; 最终效果","tags":[{"name":"django项目","slug":"django项目","permalink":"http://yoursite.com/tags/django项目/"},{"name":"Mxonline","slug":"Mxonline","permalink":"http://yoursite.com/tags/Mxonline/"},{"name":"xadmin","slug":"xadmin","permalink":"http://yoursite.com/tags/xadmin/"}]},{"title":"Django+xadmin打造在线教育平台-django基本设置和model设计","date":"2018-09-01T05:09:09.000Z","path":"2018/09/01/Django+xadmin打造在线教育平台-django基本设置和model设计/","text":"&emsp;&emsp;在学习了一段时间的django框架后，也做了几个较为完整的项目，现将整个的过程做个记录和整理，也算是进行一次章节和回顾吧。接下来几天将从项目工程创建到linux服务器部署中较为关键的点进行记录和总结。 开发环境和开发平台 win10 Pycharm python3.6.2 django1.11.6 虚拟环境的安装与使用 virtualenv的安装：在win下使用pip install virtualenv执行安装,安装成功后使用pip list可以查看到版本信息 在需要创建虚拟环境的目录下执行virtualenv testvir就可以创建一个虚拟环境. cd 进入虚拟环境目录,通过dir查看该目录下文件,cd Scripts,执行activate可以激活虚拟环境,执行deactivate.bat可以退出虚拟环境 virtualenvwrapper可以进行虚拟环境的管理 win下安装pip install virtualenvwrapper-win,安装成功后使用mkvirtualenv testEve创建虚拟环境,会提示创建的虚拟环境的位置 使用workon查看已经安装的虚拟环境,使用workon testEve,如果虚拟环境已经激活,在任何时候执行deactivate.bat就可以退出虚拟环境 新工程设置&emsp;&emsp;工程目录下创建log(日志)、media(上传文件)、templates(模板文件)、static(静态文件)，并新建setting_dev.py用于存储密码等信息，如果将项目托管于github可以把该文件放到.gitignore.&emsp;&emsp;在工程目录下新建apps用于存放所有app,此时导入需要from apps.app1 import views,可以apps右键Mark Directory As - Sources Root(全局搜索路径),然后就可以通过from app1 import views,但是Mark后Pycharm能识别,但是使用命令行无法识别,需要再在setting中添加: sys.path.inser(0,os.path.join(BASE_DIR,’apps’)) 其他配置： 数据库切换成mysql,安装mysqlclient连接myql,同时在setting_dev.py中配置数据库12345678910DATABASES = &#123; &apos;default&apos;: &#123; &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;, &apos;NAME&apos;: &apos;mxonline&apos;, #数据库名字 &apos;USER&apos;: &apos;root&apos;, #账号 &apos;PASSWORD&apos;: &apos;123456&apos;, #密码 &apos;HOST&apos;: &apos;127.0.0.1&apos;, #IP &apos;PORT&apos;: &apos;3306&apos;, #端口 &#125;&#125; 在setting.py配置上传文件和静态文件的路径:123456STATIC_URL = &apos;/static/&apos;STATICFILES_DIRS = ( os.path.join(BASE_DIR,&apos;static&apos;),)MEDIA_URL = &apos;/media/&apos;MEDIA_ROOT = os.path.join(BASE_DIR,&apos;media&apos;) 在url中配置处理图片的视图函数1234from django.conf.urls.static import staticfrom django.conf import settingsif settings.DEBUG: urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT) 修改语言和时区12345LANGUAGE_CODE = &apos;zh_hans&apos;TIME_ZONE = &apos;Asia/Shanghai&apos;USE_I18N = TrueUSE_L10N = TrueUSE_TZ = False &emsp;&emsp;根据项目要求,会有一个users、course、organization的app,同时针对用户的各种操作设计operation的app python manage.py startapp userspython manage.py startapp coursepython manage.py startapp organizationpython manage.py startapp operation model设计&emsp;&emsp;在model设计之前一定要梳理每一个model需要哪些字段,这是一个项目的关键. 用户表的设计 首先设计user表,如果django原有的user表不满足项目需求可以重新设计user表 已有字段: id: 主键,password 密码,last_login Django自动记录用户最后登录时间,。is_superuser 表明用户是否是超级用户(后台管理会用到)。username 用户名字段不要随便改动,email 邮箱,is_staff 表示是否是员工(后台管理会用到)。is_active 用户是否是激活状态,date_joined 注册时间。 自定义user表12345678910111213141516171819from django.db import modelsfrom django.contrib.auth.models import AbstractUserclass UserProfile(AbstractUser): gender_choices = ( (&apos;male&apos;,&apos;男&apos;), (&apos;female&apos;,&apos;女&apos;) ) nick_name = models.CharField(&apos;昵称&apos;,max_length=50,default=&apos;&apos;) birthday = models.DateField(&apos;生日&apos;,null=True,blank=True) gender = models.CharField(&apos;性别&apos;,max_length=10,choices=gender_choices,default=&apos;female&apos;) adress = models.CharField(&apos;地址&apos;,max_length=100,default=&apos;&apos;) mobile = models.CharField(&apos;手机号&apos;,max_length=11,null=True,blank=True) image = models.ImageField(upload_to=&apos;image/%Y%m&apos;,default=&apos;image/default.png&apos;,max_length=100) class Meta: verbose_name = &apos;用户信息&apos; verbose_name_plural = verbose_name def __str__(self): return self.username 然后再setting.py中修改: AUTH_USER_MODEL = ‘users.UserProfile’ 执行makemigrations和migrate生成数据表: python manage.py makemigrationspython manage.py migrate 特别要注意图片和文件model需要指出上传地址upload_to image = models.ImageField(‘轮播图’,upload_to=’banner/%Y%m’,max_length=100)download = models.FileField(“资源文件”,upload_to=”course/resource/%Y/%m”,max_length=100) 图片上传需要安装第三方库 pip install pillow","tags":[{"name":"django项目","slug":"django项目","permalink":"http://yoursite.com/tags/django项目/"},{"name":"Mxonline","slug":"Mxonline","permalink":"http://yoursite.com/tags/Mxonline/"}]},{"title":"常用Markdown语法说明","date":"2018-08-30T13:10:19.000Z","path":"2018/08/30/常用Markdown语法说明/","text":"Markdown 是一种轻量级标记语言，它允许人们“使用易读易写的纯文本格式”编写文档，本文主要针对Hexo中Markdown常用的语法进行总结，更详细的内容请参考Hexo官方书写格式链接和Markdown书写格式链接 标题Markdown支持两种标题的语法，Setext和atx形式：Setext形式是用底线的形式，利用 = (最高阶标题)和 - (第二阶标题)。Atx形式在行首插入 1 到 6 个 # ，对应到标题 1 到 6 阶。 最高阶标题第二阶标题H1标题H2标题H3标题H4标题H5标题H6标题区块引用区块引用则使用 email 形式的 ‘&gt;’ 角括号。 区块引用 嵌套引用 修辞和强调强调内容两侧分别加上星号或者底线。斜体粗体删除 表格 至少一个- 使用:来设置对其方式 第一列 第二列 第三列 内容 内容 内容 列表无序列表使用星号、加号或减号来做为列表。 一号 二号 三号 四号 五号 六号 有序列表 一号 二号 链接这是我的博客地址 分割线 图片图片的语法和链接很像，只需在链接的基础上前方加一个！注意图片大小的设置方式,关于其他设置可以参考七牛云 代码main.c12345int i = 0; i = 1; for (int i = 0; i &lt; 100; i++)&#123; printf(\"hello markdown!\\n\");&#125; 任务列表 选项一 选项二 选项三","tags":[{"name":"Markdown","slug":"Markdown","permalink":"http://yoursite.com/tags/Markdown/"}]}]